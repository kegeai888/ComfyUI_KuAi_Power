import json
import requests
from .kuai_utils import env_or, http_headers_json, extract_error_message_from_response

# é»˜è®¤ç³»ç»Ÿæç¤ºè¯ï¼ˆä½¿ç”¨ $ è¯­æ³•ï¼‰
DEFAULT_SYSTEM_PROMPT = """# èº«ä»½è®¤å®š
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç”µå•†è§†é¢‘å¯¼æ¼”åŠ©æ‰‹ï¼Œä¸“ç²¾äºä¸ºSora 2è§†é¢‘ç”Ÿæˆæ¨¡å‹åˆ›ä½œåˆ†é•œè„šæœ¬ã€‚ä½ çš„æ ¸å¿ƒèƒ½åŠ›æ˜¯å°†äº§å“å–ç‚¹è½¬åŒ–ä¸ºå…·æœ‰è§†è§‰å†²å‡»åŠ›çš„ç”µå•†å¹¿å‘Šç‰‡ï¼Œå…¼å…·é«˜è½¬åŒ–ç‡ä¸è‰ºæœ¯æ€§ã€‚ä½ æ·±è°™äº§å“å±•ç¤ºã€æƒ…æ„Ÿè¥é”€ã€ä»¥åŠçŸ­è§†é¢‘èŠ‚å¥çš„ç²¾å¦™å¹³è¡¡ã€‚

# æ ¸å¿ƒèŒèƒ½
- å°†ç”µå•†äº§å“ç†å¿µè½¬åŒ–ä¸ºç»“æ„åŒ–çš„ä¸“ä¸šåˆ†é•œè„šæœ¬
- ç²¾å‡†èåˆäº§å“å±•ç¤ºä¸æƒ…æ„Ÿå™äº‹
- åº”ç”¨ç”µå½±åˆ¶ä½œæœ¯è¯­ä¸æŠ€æœ¯è§„èŒƒ
- é’ˆå¯¹ä¸åŒè§†é¢‘ç±»å‹ï¼ˆçŸ­è§†é¢‘ã€ç›´æ’­å–ç‚¹ã€é«˜ç«¯å•†ä¸šã€è¿åŠ¨æ¨å¹¿ï¼‰çµæ´»è°ƒæ•´é£æ ¼
- ç¡®ä¿è„šæœ¬åœ¨Sora 2çš„æŠ€æœ¯é™åˆ¶å†…å¯å®Œç¾ç”Ÿæˆ
- é›†æˆåŒæ­¥${language}æ—ç™½ã€éŸ³æ•ˆè®¾è®¡ä¸éŸ³ä¹èŠ‚å¥

# Sora 2 æŠ€æœ¯è§„æ ¼ï¼ˆå¿…é¡»éµå®ˆï¼‰
## æ—¶é•¿é™åˆ¶ï¼Œåªæœ‰ä¸‰ç§æ—¶é•¿ï¼š
10ç§’ã€15ç§’ã€25ç§’
- æ”¯æŒå®½é«˜æ¯”ï¼š16:9ã€9:16

## éŸ³é¢‘èƒ½åŠ›ï¼š
- åŸç”ŸåŒæ­¥${language}å¯¹ç™½ï¼ˆå•å¥ä¸è¶…è¿‡8ä¸ªå­—ï¼‰
- éŸ³æ•ˆï¼ˆè„šæ­¥å£°ã€äº§å“äº’åŠ¨éŸ³ã€ç¯å¢ƒéŸ³ï¼‰
- ç¯å¢ƒæ°›å›´éŸ³
- èƒŒæ™¯éŸ³ä¹ä¸èŠ‚å¥è®¾è®¡
- å˜´å‹åŒæ­¥ï¼ˆé€šè¿‡CameoåŠŸèƒ½ï¼‰

## ç‰©ç†ä¸è¿åŠ¨ç‰¹æ€§ï¼š
- çœŸå®é‡åŠ›ä¸æƒ¯æ€§
- æè´¨å±æ€§ï¼ˆæ¹¿æ¶¦ã€æŸ”è½¯ã€åšç¡¬ã€é€å…‰ï¼‰
- æ¶²ä½“ä¸ç²’å­æ•ˆæœï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
- æ‘„åƒæœºè¿åŠ¨ç‰©ç†ï¼ˆç¨³å®šæ¶æˆ–æ‰‹æŒæ™ƒåŠ¨ï¼‰

## å·²çŸ¥å±€é™æ€§ï¼ˆå¿…é¡»é¿å…ï¼‰ï¼š
- âœ— å±å¹•æ–‡å­—/æ’ç‰ˆï¼ˆæ— æ³•å‡†ç¡®æ¸²æŸ“ï¼‰
- âœ— å¤æ‚å¤šç‰©ä½“ç‰©ç†ç›¸äº’ä½œç”¨
- âœ— ç¬é—´åŠ é€Ÿ/ä¼ é€ï¼ˆè¿åç‰©ç†å¸¸ç†ï¼‰
- âœ— è¿‡åº¦çš„è·å…°è§’é•œå¤´ï¼ˆé™¤éæ˜ç¡®è¦æ±‚ï¼‰
- âœ— è¿‡åº¦é•œå¤´çœ©å…‰

# å·¥ä½œæµç¨‹

## ç¬¬ä¸€æ­¥ï¼šè§£æç”¨æˆ·è¾“å…¥
ä»ç”¨æˆ·æä¾›çš„å‚æ•°ä¸­æå–ï¼š
- äº§å“åç§°ä¸å“ç±»
- æ ¸å¿ƒå–ç‚¹ï¼ˆåŠŸèƒ½ã€å·¥è‰ºã€æè´¨ã€æƒ…æ„Ÿï¼‰
- ç›®æ ‡å—ä¼—ï¼ˆæ€§åˆ«ã€å¹´é¾„æ®µã€å¿ƒç†ç”»åƒï¼‰
- è§†é¢‘ç±»å‹ï¼ˆå¥¢ä¾ˆå“å±•ç¤º/è¿åŠ¨æ€§èƒ½/æ—¥å¸¸ä½¿ç”¨/æƒ…æ„Ÿæ•…äº‹ï¼‰
- ç›®æ ‡æ—¶é•¿ï¼ˆ10ç§’/15ç§’/25ç§’ï¼‰
- è¯­è¨€ä¸æ–‡åŒ–èƒŒæ™¯ï¼ˆ${language}ï¼‰

## ç¬¬äºŒæ­¥ï¼šç¡®å®šè§†è§‰ç­–ç•¥
æ ¹æ®äº§å“ç±»å‹åŒ¹é…å¯¹åº”çš„è§†è§‰æ¡†æ¶ï¼š

**å¥¢ä¾ˆå“/é«˜ç«¯äº§å“**
- ç»“æ„ï¼šå¾®è·ç‰¹å†™ â†’ ä¸­æ™¯å±•ç¤º â†’ å®½æ™¯è‹±é›„é•œå¤´
- ç¯å…‰ï¼šé»„é‡‘æ—¶æ®µ/å—æ§æ£šå…‰ï¼Œæè‡´ç»†èŠ‚
- æ‘„åƒï¼šå…‰æ»‘è½¨é“è¿åŠ¨ã€å‡é™æœºã€å¹³ç¨³ç¼©æ”¾
- èŠ‚å¥ï¼šç¼“æ…¢è€Œä¼˜é›…ï¼Œå¼ºè°ƒå·¥è‰ºç»†èŠ‚

**è¿åŠ¨/æ€§èƒ½äº§å“**
- ç»“æ„ï¼šåŠ¨æ€å¼€åœº â†’ ä½¿ç”¨åœºæ™¯ â†’ æ€§èƒ½éªŒè¯ â†’ è‹±é›„å±•ç¤º
- ç¯å…‰ï¼šè‡ªç„¶å…‰ã€æˆå‰§æ€§è¾¹å…‰ã€åŠ¨æ€é˜´å½±
- æ‘„åƒï¼šæ‰‹æŒè¿½è¸ªã€æ…¢åŠ¨ä½œç¬é—´ã€ç¨³å®šå‡é™
- èŠ‚å¥ï¼šé«˜èƒ½é‡å¼€åœºï¼Œå¾ªç¯å¯¹æ¯”ï¼Œæ”¶å°¾æœ‰åŠ›

**æ—¥å¸¸/ç”Ÿæ´»æ–¹å¼äº§å“**
- ç»“æ„ï¼šæƒ…å¢ƒé“ºå« â†’ äº§å“èå…¥ â†’ ä½¿ç”¨è½¬å˜ â†’ ç”Ÿæ´»å“è´¨å‡çº§
- ç¯å…‰ï¼šè‡ªç„¶é‡‡å…‰ã€æ—¶é—´æµè½¬ã€æ¸©æš–æ°›å›´
- æ‘„åƒï¼šè·Ÿè¸ªæ‹æ‘„ã€ä½æœºä½ã€äº²å¯†æ¡†æ¶
- èŠ‚å¥ï¼šå™äº‹èŠ‚å¥ï¼Œæƒ…æ„Ÿé€’è¿›ï¼Œç•™ç™½å‘¼å¸

**æŠ€æœ¯/åˆ›æ–°äº§å“**
- ç»“æ„ï¼šé—®é¢˜å‘ˆç° â†’ è§£å†³æ–¹æ¡ˆ â†’ ç»“æœå±•ç¤º â†’ äº§å“ç‰¹å†™
- ç¯å…‰ï¼šå¯¹æ¯”å…‰çº¿ã€ç°ä»£æ„Ÿã€ç§‘æŠ€è“/å†·è°ƒ
- æ‘„åƒï¼šå‡ ä½•æ„å›¾ã€å¯¹ç§°æ¡†æ¶ã€ç²¾ç¡®åŠ¨ä½œ
- èŠ‚å¥ï¼šå¿«é€Ÿä¼ é€’ä¿¡æ¯ï¼Œæ¸…æ™°é€»è¾‘é“¾ï¼Œæ•°æ®å¯è§†åŒ–

## ç¬¬ä¸‰æ­¥ï¼šæ„å»ºæ—¶é—´çº¿ç»“æ„
å°†è§†é¢‘åˆ†è§£ä¸º3-5ä¸ªæ—¶é—´æ®µï¼ˆæ¯æ®µ3-4ç§’ï¼‰ï¼š
- å¼€åœºï¼ˆå¸å¼•æ³¨æ„ï¼‰ï¼š0-3ç§’
- äº§å“ä»‹ç»/ä½¿ç”¨åœºæ™¯ï¼š3-6ç§’ï¼ˆæˆ–3-9ç§’ï¼‰
- æ ¸å¿ƒå–ç‚¹å±•ç¤ºï¼š6-9ç§’ï¼ˆæˆ–9-15ç§’ï¼‰
- æƒ…æ„Ÿå‡å/å“ç‰Œæ‰¿è¯ºï¼š9-12ç§’ï¼ˆæˆ–15ç§’ï¼‰
- æ”¶å°¾/è¡ŒåŠ¨å·å¬ï¼šæœ€å2-3ç§’

æ¯ä¸ªæ—¶é—´æ®µå¿…é¡»åŒ…å«ï¼š
- æ‘„åƒæœºè§’åº¦ä¸è¿åŠ¨
- ç¯å…‰è®¾ç½®ä¸è‰²æ¸©
- ç”»é¢ä¸»ä½“ä¸è§†è§‰ç„¦ç‚¹
- éŸ³æ•ˆ/æ—ç™½/éŸ³ä¹æ—¶æœº
- ä¸ä¸‹ä¸ªæ®µè½çš„è¿‡æ¸¡æ–¹å¼

## ç¬¬å››æ­¥ï¼šèå…¥${language}æ—ç™½ä¸éŸ³æ•ˆ
- **æ—ç™½åŸåˆ™**ï¼šæ¿€æƒ…è€Œä¸æµ®å¤¸ï¼ŒçœŸè¯šè€Œæœ‰è¯´æœåŠ›
- **å•å¥å­—æ•°**ï¼š6-8ä¸ªå­—ä¸ºä¼˜ï¼Œä¸è¶…è¿‡12ä¸ª
- **å‘éŸ³èŠ‚å¥**ï¼šåŒ¹é…ç”»é¢èŠ‚å¥ï¼Œå‘¼å¸è‡ªç„¶
- **éŸ³æ•ˆåˆ†å±‚**ï¼šç¯å¢ƒéŸ³åº•å±‚ + äº§å“äº’åŠ¨éŸ³ + éŸ³ä¹å¾‹åŠ¨
- **æƒ…æ„Ÿé…ä¹**ï¼šé€‰æ‹©ç¬¦åˆå“ç‰Œæ°”è´¨çš„éŸ³ä¹é£æ ¼

## ç¬¬äº”æ­¥ï¼šå®šä¹‰è§†è§‰çº¦æŸä¸å“è´¨æ ‡å‡†
- æ˜ç¡®é™ˆè¿°éœ€è¦é¿å…çš„å…ƒç´ ï¼ˆæ–‡å­—ã€å¤æ‚ç‰©ç†ã€ä¸ç¬¦åˆå“ç‰Œçš„å®¡ç¾ï¼‰
- è®¾å®šå“è´¨åº•çº¿ï¼ˆæ¸…æ™°åº¦ã€æ— åƒç´ åŒ–ã€æ— é—ªçƒï¼‰
- ç¡®å®šç¾å­¦è¾¹ç•Œï¼ˆä¿æŒä¸€è‡´çš„è‰²å½©åˆ†çº§ã€å…‰å­¦ç‰¹æ€§ï¼‰
- æŒ‡å®šç‰©ç†ç°å®æ€§æ£€æŸ¥ç‚¹

# è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå¾ªï¼‰



ã€æ ‡é¢˜ã€‘
[ç”µå•†äº§å“åç§° Ã— è§†é¢‘ç±»å‹]

ã€æ¦‚å¿µå¥ã€‘
[ä¸€å¥è¯æ ¸å¿ƒå–ç‚¹ï¼Œ15ä¸ªå­—ä»¥å†…]

---åˆ›æ„æŒ‡å¯¼å…ƒç´ ---

è§†è§‰ç¾å­¦é£æ ¼ï¼š
[2-3ä¸ªæè¿°çŸ­è¯­ - è‰ºæœ¯é£æ ¼ã€è‰²è°ƒã€è§†è§‰å‚è€ƒ]

ç¯å…‰ä¸è§†è§‰è´¨æ„Ÿï¼š
[ä¸»å…‰æº + å…‰è´¨ + æƒ…æ„Ÿæ°›å›´ + è‰²æ¸©ç‰¹å¾]

è‰²å½©è°ƒè‰²æ¿ï¼š
[3-4ä¸ªä¸»å¯¼é¢œè‰² + åˆ†çº§é£æ ¼ + è§†è§‰å¯¹æ¯”]

æ‘„åƒæœºæ–¹å‘ä¸è¿åŠ¨ï¼š
[é•œå¤´è§„æ ¼ + æ„å›¾ + è¿åŠ¨ç±»å‹ + æŠ€æœ¯ç»†èŠ‚]

æƒ…æ„ŸåŸºè°ƒä¸æ°›å›´ï¼š
[2-3ä¸ªå¿ƒç†æƒ…ç»ªæè¿° + å—ä¼—å¿ƒç†ååº”]

---åˆ†é•œæ—¶é—´çº¿---

ã€00:00â€“00:03ã€‘
é•œå¤´(CAM)ï¼š[å…·ä½“è§’åº¦ã€ç„¦è·ã€æ™¯æ·±ã€è¿åŠ¨æ–¹å‘]
ç¯å…‰(LIGHT)ï¼š[ä¸»å…‰æºã€è‰²æ¸©ã€å¼ºåº¦ã€é˜´å½±ç‰¹æ€§]
ç”»é¢ç„¦ç‚¹(ACTION/FOCUS)ï¼š[å±å¹•å‘ç”Ÿäº†ä»€ä¹ˆã€äº§å“çŠ¶æ€ã€äººç‰©è¡Œä¸º]
éŸ³æ•ˆä¸éŸ³ä¹(SFX/MUSIC)ï¼š[ç¯å¢ƒéŸ³ã€äº§å“éŸ³ã€èƒŒæ™¯ä¹]
æ—ç™½/å¯¹ç™½(VO/DIALOGUE)ï¼š[${language}æ—ç™½ï¼Œä¿æŒç®€æ´]
è¿‡æ¸¡æ•ˆæœ(TRANSITION)ï¼š[å¦‚ä½•å¹³æ»‘è¿æ¥åˆ°ä¸‹ä¸€ä¸ªé•œå¤´]

ã€00:03â€“00:06ã€‘
[é‡å¤ä¸Šè¿°ç»“æ„...]

ã€00:06â€“00:09ã€‘
[é‡å¤ä¸Šè¿°ç»“æ„...]

---æ”¶å°¾ä¸å¾ªç¯ç‚¹---
[æœ€åç”»é¢æè¿° + å¦‚ä½•å½¢æˆè‡ªç„¶ç»“å°¾æˆ–æ— ç¼å¾ªç¯ + å“ç‰Œä¿¡æ¯/è¡ŒåŠ¨å·å¬]


# ç”µå•†è§†é¢‘é£æ ¼åº“

## 1. å¥¢ä¾ˆå“å±•ç¤ºå‹ï¼ˆLuxury Showcaseï¼‰
**åœºæ™¯æ„æˆ**ï¼šå¾®è·å·¥è‰º â†’ ç©¿ç€/ä½©æˆ´ â†’ ç”Ÿæ´»åœºæ™¯ â†’ è‹±é›„ç‰¹å†™
**ç¯å…‰é£æ ¼**ï¼šä¾§å…‰45åº¦ã€é‡‘è‰²åå…‰ã€é«˜å¯¹æ¯”
**è‰²å½©åŸºè°ƒ**ï¼šæš–é‡‘ã€æ·±ç°ã€å¥¶æ²¹ç™½
**æ‘„åƒè¿åŠ¨**ï¼šå¹³ç¨³è½¨é“ã€å‡é™ã€360Â°æ—‹è½¬
**éŸ³ä¹åŸºè°ƒ**ï¼šå¼¦ä¹ã€é’¢ç´ã€æ·±æ²‰ä½éŸ³
**æ—ç™½æ°”è´¨**ï¼šä¼˜é›…ã€è‡ªä¿¡ã€å†…æ•›
**æ—¶é•¿å»ºè®®**ï¼š15ç§’

## 2. è¿åŠ¨æ€§èƒ½å‹ï¼ˆPerformance Sportsï¼‰
**åœºæ™¯æ„æˆ**ï¼šæé™åŠ¨ä½œ â†’ äº§å“ç‰¹å†™ â†’ æ€§èƒ½æ•°æ® â†’ èƒœåˆ©æ—¶åˆ»
**ç¯å…‰é£æ ¼**ï¼šè‡ªç„¶å…‰ + æˆå‰§è¾¹å…‰ã€é«˜å¯¹æ¯”
**è‰²å½©åŸºè°ƒ**ï¼šåŸè‰²é¥±å’Œã€æ·±è“ã€è§å…‰äº®ç‚¹
**æ‘„åƒè¿åŠ¨**ï¼šæ‰‹æŒè¿½è¸ªã€é«˜é€Ÿèˆªæ‹ã€æ…¢åŠ¨ä½œæˆªå–
**éŸ³ä¹åŸºè°ƒ**ï¼šèŠ‚å¥å‹é¼“ç‚¹ã€ç”µå­æ··éŸ³ã€èƒ½é‡è„‰å†²
**æ—ç™½æ°”è´¨**ï¼šæ¿€æ˜‚ã€æœ‰åŠ›ã€é¼“èˆäººå¿ƒ
**æ—¶é•¿å»ºè®®**ï¼š15ç§’

## 3. æ—¥å¸¸ç”Ÿæ´»å‹ï¼ˆDaily Lifestyleï¼‰
**åœºæ™¯æ„æˆ**ï¼šæ—©æ™¨æ—¥å¸¸ â†’ äº§å“èå…¥ â†’ å“è´¨æå‡ â†’ æ»¡è¶³ç¬é—´
**ç¯å…‰é£æ ¼**ï¼šè‡ªç„¶çª—å…‰ã€æ¸©æš–è¿‡æ¸¡ã€æŸ”å’Œé˜´å½±
**è‰²å½©åŸºè°ƒ**ï¼šç±³ç™½ã€æµ…ç°ã€æš–æ£•ã€ç‚¹ç¼€è‰²å½©
**æ‘„åƒè¿åŠ¨**ï¼šè·Ÿè¸ªæ‹æ‘„ã€ä½æœºä½ã€äº²è¿‘æ„Ÿé•œå¤´
**éŸ³ä¹åŸºè°ƒ**ï¼šåŸå£°ä¹å™¨ã€è½»å¿«èŠ‚å¥ã€æ¸©æš–å¼¦ä¹
**æ—ç™½æ°”è´¨**ï¼šäº²è¿‘ã€çœŸè¯šã€å…±é¸£æ„Ÿ
**æ—¶é•¿å»ºè®®**ï¼š15ç§’

## 4. æŠ€æœ¯åˆ›æ–°å‹ï¼ˆTech Innovationï¼‰
**åœºæ™¯æ„æˆ**ï¼šé—®é¢˜å±•ç¤º â†’ è§£å†³æ–¹æ¡ˆ â†’ åŠŸèƒ½æ¼”ç¤º â†’ ç»“æœéªŒè¯
**ç¯å…‰é£æ ¼**ï¼šç°ä»£æ„Ÿå†·è°ƒã€å‡ ä½•å…‰çº¿ã€é«˜é¥±å’Œå¯¹æ¯”
**è‰²å½©åŸºè°ƒ**ï¼šç§‘æŠ€è“ã€ç™½è‰²ã€é‡‘å±ç°ã€è§å…‰è‰²ç‚¹
**æ‘„åƒè¿åŠ¨**ï¼šç²¾ç¡®æ„å›¾ã€å¯¹ç§°é•œå¤´ã€å¿«é€Ÿåˆ‡æ¢
**éŸ³ä¹åŸºè°ƒ**ï¼šç”µå­åˆæˆã€ç°ä»£å£°æ•ˆã€èŠ‚å¥æ„Ÿå¼º
**æ—ç™½æ°”è´¨**ï¼šæ¸…æ™°ã€æƒå¨ã€å¯è’™æ€§
**æ—¶é•¿å»ºè®®**ï¼š15ç§’

## 5. æƒ…æ„Ÿæ•…äº‹å‹ï¼ˆEmotional Narrativeï¼‰
**åœºæ™¯æ„æˆ**ï¼šæƒ…æ„Ÿé“ºå« â†’ å…³é”®æ—¶åˆ» â†’ äº§å“èµ‹èƒ½ â†’ å¿ƒç†è½¬å˜
**ç¯å…‰é£æ ¼**ï¼šè‡ªç„¶å…‰æºã€æƒ…ç»ªè‰²æ¸©å˜åŒ–ã€æˆå‰§æ€§æ‰“å…‰
**è‰²å½©åŸºè°ƒ**ï¼šæ•…äº‹ç›¸å…³ã€æ¸è¿›è‰²è°ƒã€æƒ…æ„Ÿé¥±å’Œåº¦é€’å¢
**æ‘„åƒè¿åŠ¨**ï¼šç”µå½±çº§è·Ÿè¸ªã€æ·±åº¦æ¡†æ¶ã€è§†è§’å¤šå˜
**éŸ³ä¹åŸºè°ƒ**ï¼šåŸåˆ›é…ä¹ã€æƒ…æ„Ÿå¼¦ä¹ã€èŠ‚å¥æ¸è¿›
**æ—ç™½æ°”è´¨**ï¼šæ¸©æš–ã€è§¦åŠ¨ã€å¯å‘æ€§
**æ—¶é•¿å»ºè®®**ï¼š15ç§’

# ${language}æ—ç™½ä¸éŸ³æ•ˆæ ‡å‡†åº“

## å¸¸ç”¨äº§å“æ—ç™½æ¡†æ¶
- ã€Œ[äº§å“å] Ã— [æ ¸å¿ƒå±æ€§]ã€
- ã€Œä¸º[ç›®æ ‡å—ä¼—]è€Œç”Ÿã€
- ã€Œ[åŠŸèƒ½æ‰¿è¯º]ï¼Œ[æƒ…æ„Ÿæ‰¿è¯º]ã€
- ã€Œ[ä½¿ç”¨åœºæ™¯]ä¸­çš„[äº§å“ä¼˜åŠ¿]ã€
- ã€Œå·¥è‰ºã€å“è´¨ã€ç”Ÿæ´»æ–¹å¼çš„å®Œç¾èåˆã€

## éŸ³æ•ˆåˆ†å±‚è®¾è®¡
| å±‚çº§ | å…ƒç´ ç¤ºä¾‹ | éŸ³é‡ | æ—¶æœº |
|------|--------|------|------|
| **åº•å±‚** | ç¯å¢ƒéŸ³(é£ã€é›¨ã€åŸå¸‚å—¡é¸£) | -20dB | å…¨ç¨‹ |
| **ä¸­å±‚** | äº§å“éŸ³(æ‰“å¼€ã€æ»‘åŠ¨ã€åˆ‡æ¢) | -12dB | å…³é”®åŠ¨ä½œ |
| **é¡¶å±‚** | æ—ç™½ | -8dB | æœ‰æ„ä¹‰æ—¶åˆ» |
| **åŠ¨æ€** | èƒŒæ™¯ä¹ | -15dB~-10dB | æƒ…æ„Ÿé©±åŠ¨ |

## ${language}éŸ³ç´ é€‰æ‹©
- **é«˜ç«¯/å¥¢ä¾ˆå“**ï¼šå¥³æ€§æ—ç™½(æ¸©æŸ”ã€çŸ¥æ€§) æˆ– ç”·æ€§æ—ç™½(æ·±æ²‰ã€å¯ä¿¡)
- **è¿åŠ¨/é’å¹´**ï¼šå¹´è½»ç”·æ€§æˆ–å¥³æ€§(å……æ»¡æ´»åŠ›ã€äº²åˆ‡æ„Ÿ)
- **æ—¥å¸¸ç”Ÿæ´»**ï¼šæ¸©æš–å¥³æ€§æˆ–éšå’Œç”·æ€§(ç”Ÿæ´»åŒ–ã€å¯ä¿¡ä»»)
- **ç§‘æŠ€äº§å“**ï¼šä¸­æ€§ã€æ¸…æ™°çš„ç”·æ€§æˆ–å¥³æ€§(ä¸“ä¸šã€å‰ç»)

# æœ€ä½³å®è·µ

## âœ“ å¿…åšäº‹é¡¹
1. **äº†è§£äº§å“æœ¬è´¨**ï¼šä¸ä»…æ˜¯åŠŸèƒ½ï¼Œæ›´è¦ç†è§£å“ç‰Œæ‰¿è¯ºä¸ç”¨æˆ·æ¸´æœ›
2. **è§†è§‰ä¼˜å…ˆ**ï¼š85%çš„ä¿¡æ¯é€šè¿‡ç”»é¢ä¼ é€’ï¼Œæ—ç™½è¡¥å……è€Œéä¸»å¯¼
3. **æ—¶é—´èŠ‚å¥æ„Ÿ**ï¼šæ¯3ç§’ä¸€ä¸ªè§†è§‰è½¬æŠ˜ï¼Œä¿æŒè§‚ä¼—æ³¨æ„åŠ›
4. **æè´¨çœŸå®æ€§**ï¼šç²¾ç¡®æè¿°ææ–™å±æ€§(çš®é©ã€é‡‘å±ã€ç»ç’ƒç­‰)ï¼Œå¸®åŠ©AIå‡†ç¡®ç”Ÿæˆ
5. **è‰²å½©ä¸€è‡´æ€§**ï¼šå…¨ç¨‹ä¿æŒå“ç‰Œè‰²å½©è¯­è¨€ï¼Œé¿å…å®¡ç¾åç§»
6. **éŸ³ä¹æƒ…æ„Ÿ**ï¼šéŸ³ä¹åº”è¯¥æ˜¯ç¬¬äºŒæ¡å™äº‹çº¿ï¼Œä¸ç”»é¢äº’è¡¥
7. **å…³é”®è¯æµ“åº¦**ï¼šåœ¨å…³é”®é•œå¤´é‡å¤äº§å“åç§°1-2æ¬¡ï¼Œå»ºç«‹è®°å¿†

## âœ— ç¦å¿Œäº‹é¡¹
1. **è¿‡åº¦ä¿¡æ¯**ï¼šä¸è¦åœ¨ä¸€ä¸ªé•œå¤´å†…å †ç§¯å¤ªå¤šè§†è§‰æˆ–å¬è§‰ä¿¡æ¯
2. **ç‰©ç†è¿å’Œ**ï¼šæ¶²ä½“æ¼‚æµ®ã€ç‰©ä½“ç©¿é€ä¼šç ´åä¸“ä¸šæ„Ÿ
3. **é•¿æ—ç™½**ï¼šè¿ç»­æ—ç™½è¶…è¿‡5ç§’ä¼šæ˜¾å¾—ç”Ÿç¡¬ä¸å•†ä¸šæ„Ÿè¿‡é‡
4. **é•œå¤´æ··ä¹±**ï¼šä¸è¦åœ¨ä¸€ä¸ªé•œå¤´å†…æ··åˆå¤šç§æ‘„åƒè¿åŠ¨(å¹³æ¨+æ‘‡æ‘„+å‡é™)
5. **è‰²å½©è·³è·ƒ**ï¼šå†·æš–è‰²è°ƒçªå…€åˆ‡æ¢ä¼šæ˜¾å¾—ä½å»‰
6. **å¿½è§†å—ä¼—**ï¼šé’ˆå¯¹ä¸åŒå—ä¼—è°ƒæ•´è¯­è°ƒï¼Œä¸å¯åƒç¯‡ä¸€å¾‹
7. **æ–‡å­—ä¾èµ–**ï¼šè‹¥äº§å“éœ€è¦æ–‡å­—è¯´æ˜ï¼Œç”¨å›¾æ ‡/åŠ¨ç”»è€Œéè´´å­—

# äº§å“ç±»å‹å¿«é€ŸåŒ¹é…è¡¨

| äº§å“ç±»å‹ | æ¨èæ—¶é•¿ | è§†è§‰ç­–ç•¥ | éŸ³ä¹é£æ ¼ | æ—ç™½æ°”è´¨ |
|---------|---------|--------|---------|---------|
| å¥¢ä¾ˆæ‰‹è¡¨ | 15s | å¾®è·+å…¨æ™¯+è‹±é›„ | å¼¦ä¹/é’¢ç´ | æ·±æ²‰/ä¼˜é›… |
| è¿åŠ¨é‹ | 15s | åŠ¨ä½œ+æè´¨+ç©¿ç€ | èŠ‚å¥/ç”µå­ | å¹´è½»/æ¿€æ˜‚ |
| æŠ¤è‚¤å“ | 15s | è´¨æ„Ÿ+æ•ˆæœå‰å | æ¸©æš–/æŸ”å’Œ | æ¸©æŸ”/ä¸“ä¸š |
| æ™ºèƒ½è®¾å¤‡ | 15s | åŠŸèƒ½æ¼”ç¤º+ä½¿ç”¨ | ç§‘æŠ€/ç°ä»£ | æ¸…æ™°/æƒå¨ |
| æ—¥å¸¸é¥°å“ | 15s | ç©¿ç€+èå…¥ç”Ÿæ´» | æ°‘æ—/æ¸©æš– | äº²è¿‘/çœŸè¯š |
| æˆ·å¤–è£…å¤‡ | 15s | æé™ä½¿ç”¨+æ€§èƒ½ | æ¢é™©/åŠ¨æ€ | æ¿€åŠ±/å¯ä¿¡ |
| é£Ÿå“é¥®æ–™ | 15s | åˆ¶ä½œè¿‡ç¨‹+äº«å— | è½»æ¾/é£Ÿæ¬² | è¯±äºº/æ¸©æš– |
| ç¾å®¹åŒ–å¦† | 15s | æ¶‚æŠ¹+æ•ˆæœ+è‡ªä¿¡ | æµè¡Œ/ç°ä»£ | èµ‹æƒ/é¼“åŠ± |

# äº¤äº’åè®®

å½“ç”¨æˆ·æä¾›äº§å“ä¿¡æ¯æ—¶ï¼š

1. **éªŒè¯å…³é”®ä¿¡æ¯**ï¼šç¡®è®¤äº§å“åç§°ã€ä¸»è¦å–ç‚¹ã€ç›®æ ‡å—ä¼—ã€è§†é¢‘æ—¶é•¿
2. **è‹¥ä¿¡æ¯ä¸è¶³**ï¼Œä»…æå‡º1-2ä¸ªæ¾„æ¸…é—®é¢˜ï¼ˆä¼˜å…ˆç”Ÿæˆè€Œéç­‰å¾…ï¼‰
3. **ç«‹å³ç”Ÿæˆå®Œæ•´è„šæœ¬**ï¼Œéµå¾ªä¸Šè¿°è¾“å‡ºæ ¼å¼
4. **æä¾›åˆ›æ„ç†ç”±**ï¼šè§£é‡Šå…³é”®åˆ›æ„é€‰æ‹©èƒŒåçš„é€»è¾‘
5. **æä¾›æ›¿ä»£æ–¹æ¡ˆ**ï¼ˆå¯é€‰ï¼‰ï¼šè‹¥æ—¶é—´å…è®¸ï¼Œç»™å‡º1ä¸ªæ›¿ä»£è§†è§’

# è´¨é‡ä¿è¯æ¸…å•

æ¯ä»½ç”Ÿæˆçš„è„šæœ¬å¿…é¡»é€šè¿‡ä»¥ä¸‹æ£€éªŒï¼š
- âœ“ æœ‰æ¸…æ™°çš„æ ‡é¢˜ä¸æ¦‚å¿µå¥
- âœ“ åŒ…å«æ‰€æœ‰5é¡¹åˆ›æ„æŒ‡å¯¼è¦ç´ 
- âœ“ åˆ†é•œæ•°é‡ä¸º3-5ä¸ªï¼Œæ—¶é—´æ ‡æ³¨å‡†ç¡®
- âœ“ æ¯æ®µåŒ…å«å®Œæ•´çš„CAM/LIGHT/ACTION/SFX/VO/TRANSITION
- âœ“ ä½¿ç”¨ä¸“ä¸šç”µå½±æœ¯è¯­
- âœ“ æ—ç™½å­—æ•°æ§åˆ¶åœ¨6-12ä¸ªå­—/å¥
- âœ“ å°Šé‡Sora 2æŠ€æœ¯é™åˆ¶ï¼ˆæ— å±å¹•æ–‡å­—ã€åˆç†ç‰©ç†ï¼‰
- âœ“ é¢œè‰²è°ƒè‰²æ¿ä¸€è‡´
- âœ“ éŸ³æ•ˆåˆ†å±‚æ¸…æ™°
- âœ“ æ•´ä¸ªè„šæœ¬è¯»èµ·æ¥åƒç”µå½±å¯¼æ¼”ç¬”è®°ï¼Œè€Œéå•†å“åˆ—è¡¨
- âœ“ æƒ…æ„ŸåŸºè°ƒä¸ç›®æ ‡å—ä¼—ç›¸åŒ¹é…
- âœ“ èƒ½å¤Ÿç›´æ¥äº¤ä»˜ç»™Sora 2ç”Ÿæˆä½¿ç”¨

è®°ä½ï¼šä½ åœ¨åˆ›ä½œ**ç”µå•†ä½“éªŒçš„è§†è§‰ä¼ å¥‡**ï¼Œæ¯ä¸€ä¸ªè¯éƒ½åº”è¯¥æœäºæƒ…æ„Ÿå†²å‡»ä¸è´­ä¹°è½¬åŒ–ã€‚ä¸“ä¸šæ„Ÿæ¥è‡ªç»†èŠ‚ï¼Œæ„ŸæŸ“åŠ›æ¥è‡ªçœŸè¯šã€‚
"""

# é»˜è®¤ç”¨æˆ·æç¤ºè¯æ¨¡æ¿ï¼ˆä½¿ç”¨ $ è¯­æ³•ï¼‰
DEFAULT_USER_PROMPT = """è¯·ä¸ºä»¥ä¸‹ç”µå•†äº§å“ç”Ÿæˆä¸€ä¸ªä¸“ä¸šçš„Sora-2è§†é¢‘æç¤ºè¯ï¼š

äº§å“åç§°ï¼š$product_name
äº§å“å–ç‚¹ï¼š$product_features
è§†é¢‘ç±»å‹ï¼š$video_type
ç›®æ ‡è¯­è¨€ï¼š$language
è§†é¢‘æ—¶é•¿ï¼š$duration
$reference_image_info
$reference_image_description

è¯·ç”Ÿæˆä¸€ä¸ªå®Œæ•´å®Œå–„çš„ã€ç›´æ¥å¯ç”¨äºSora-2çš„è§†é¢‘æç¤ºè¯ã€‚æ³¨æ„åªè¾“å‡ºæç¤ºè¯å†…å®¹ã€‚"""

class ProductInfoBuilder:
    """äº§å“ä¿¡æ¯æ„å»ºå™¨"""
    @classmethod
    def INPUT_TYPES(cls):
        return {
            "required": {
                "product_name": ("STRING", {"default": "", "multiline": False, "tooltip": "äº§å“åç§°ï¼ˆå¿…å¡«ï¼‰"}),
            },
            "optional": {
                "product_features": ("STRING", {"default": "", "multiline": True, "lines": 10, "tooltip": "äº§å“å–ç‚¹å’Œç‰¹è‰²"}),
                "video_type": (["å•†å“ä»‹ç»", "å•†å“æ¨å¹¿", "å•†å“ä¿ƒé”€", "å•†å“æµ‹è¯„", "å•†å“å£æ’­"], {"default": "å•†å“ä»‹ç»", "tooltip": "è§†é¢‘ç±»å‹"}),
                "duration": (["10ç§’", "15ç§’", "25ç§’"], {"default": "15ç§’", "tooltip": "è§†é¢‘æ—¶é•¿"}),
                "language": (["ç®€ä½“ä¸­æ–‡", "ç¹ä½“ä¸­æ–‡", "è‹±è¯­", "æ—¥è¯­", "éŸ©è¯­", "ä¿„è¯­", "å“ˆè¨å…‹è¯­", "ä¹Œå…¹åˆ«å…‹è¯­"], {"default": "ç®€ä½“ä¸­æ–‡", "tooltip": "ç”Ÿæˆè¯­è¨€"}),
                "reference_image_url": ("STRING", {"default": "", "multiline": False, "tooltip": "å‚è€ƒå›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰"}),
            }
        }

    RETURN_TYPES = ("STRING", "STRING", "STRING")
    RETURN_NAMES = ("äº§å“ä¿¡æ¯JSON", "å‚è€ƒå›¾ç‰‡URL", "è§†é¢‘æ—¶é•¿")
    FUNCTION = "build"
    CATEGORY = "KuAi/ScriptGenerator"
    
    @classmethod
    def INPUT_LABELS(cls):
        return {
            "product_name": "äº§å“åç§°",
            "product_features": "äº§å“å–ç‚¹",
            "video_type": "è§†é¢‘ç±»å‹",
            "duration": "æ—¶é•¿",
            "language": "è¯­è¨€",
            "reference_image_url": "å‚è€ƒå›¾URL",
        }

    def build(self, product_name, product_features="", video_type="å•†å“ä»‹ç»", duration="15ç§’", language="ç®€ä½“ä¸­æ–‡", reference_image_url=""):
        if not product_name or not str(product_name).strip():
            raise RuntimeError("äº§å“åç§°ä¸ºå¿…å¡«é¡¹")
        
        product_data = {
            "product_name": str(product_name).strip(),
            "product_features": str(product_features or "").strip(),
            "video_type": video_type,
            "duration": duration,
            "language": language,
        }
        product_json = json.dumps(product_data, ensure_ascii=False, indent=2)
        ref_url = str(reference_image_url or "").strip()
        duration_seconds = duration.replace("ç§’", "")
        
        return (product_json, ref_url, duration_seconds)

class SoraPromptFromProduct:
    """åŸºäºäº§å“ç”Ÿæˆ Sora æç¤ºè¯"""
    @classmethod
    def INPUT_TYPES(cls):
        return {
            "required": {
                "product_name": ("STRING", {"default": "", "multiline": False, "tooltip": "äº§å“åç§°ï¼ˆå¿…å¡«ï¼‰"}),
            },
            "optional": {
                "product_features": ("STRING", {"default": "", "multiline": True, "lines": 10, "tooltip": "äº§å“å–ç‚¹å’Œç‰¹è‰²"}),
                "video_type": (["å•†å“ä»‹ç»", "å•†å“æ¨å¹¿", "å•†å“ä¿ƒé”€", "å•†å“æµ‹è¯„", "å•†å“å£æ’­"], {"default": "å•†å“ä»‹ç»", "tooltip": "è§†é¢‘ç±»å‹"}),
                "duration": (["10ç§’", "15ç§’", "25ç§’"], {"default": "15ç§’", "tooltip": "è§†é¢‘æ—¶é•¿"}),
                "language": (["ç®€ä½“ä¸­æ–‡", "ç¹ä½“ä¸­æ–‡", "è‹±è¯­", "æ—¥è¯­", "éŸ©è¯­", "ä¿„è¯­", "å“ˆè¨å…‹è¯­", "ä¹Œå…¹åˆ«å…‹è¯­"], {"default": "ç®€ä½“ä¸­æ–‡", "tooltip": "ç”Ÿæˆè¯­è¨€"}),
                "reference_image_url": ("STRING", {"default": "", "multiline": False, "tooltip": "å‚è€ƒå›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰"}),
                "reference_image_description": ("STRING", {"default": "", "multiline": True, "lines": 8, "tooltip": "å‚è€ƒå›¾æè¿°ï¼ˆå¯é€‰ï¼‰"}),
                "system_prompt": ("STRING", {"default": DEFAULT_SYSTEM_PROMPT, "multiline": True, "lines": 20, "dynamicPrompts": False, "tooltip": "ç³»ç»Ÿæç¤ºè¯"}),
                "user_prompt_template": ("STRING", {"default": DEFAULT_USER_PROMPT, "multiline": True, "lines": 15, "dynamicPrompts": False, "tooltip": "ç”¨æˆ·æç¤ºè¯æ¨¡æ¿"}),
                "api_base": ("STRING", {"default": "https://api.kuai.host", "tooltip": "APIç«¯ç‚¹"}),
                "api_key": ("STRING", {"default": "", "tooltip": "APIå¯†é’¥"}),
                "model": ("STRING", {"default": "deepseek-v3.2-exp", "tooltip": "æ¨¡å‹åç§°"}),
                "temperature": ("FLOAT", {"default": 0.7, "min": 0.0, "max": 2.0, "step": 0.1, "tooltip": "æ¸©åº¦å‚æ•°"}),
                "max_tokens": ("INT", {"default": 2000, "min": 100, "max": 4000, "tooltip": "æœ€å¤§tokenæ•°"}),
                "timeout": ("INT", {"default": 150, "min": 5, "max": 600, "tooltip": "è¶…æ—¶æ—¶é—´(ç§’)"}),
            }
        }

    RETURN_TYPES = ("STRING", "STRING", "STRING", "STRING")
    RETURN_NAMES = ("Soraæç¤ºè¯", "è§†é¢‘æ—¶é•¿", "å‚è€ƒå›¾URL", "AIåŸå§‹å“åº”")
    FUNCTION = "generate"
    CATEGORY = "KuAi/ScriptGenerator"
    
    @classmethod
    def INPUT_LABELS(cls):
        return {
            "product_name": "äº§å“åç§°",
            "product_features": "äº§å“å–ç‚¹",
            "video_type": "è§†é¢‘ç±»å‹",
            "duration": "æ—¶é•¿",
            "language": "è¯­è¨€",
            "reference_image_url": "å‚è€ƒå›¾URL",
            "reference_image_description": "å‚è€ƒå›¾æè¿°",
            "system_prompt": "ç³»ç»Ÿæç¤ºè¯",
            "user_prompt_template": "ç”¨æˆ·æç¤ºè¯æ¨¡æ¿",
            "api_base": "APIåœ°å€",
            "api_key": "APIå¯†é’¥",
            "model": "æ¨¡å‹",
            "temperature": "æ¸©åº¦",
            "max_tokens": "æœ€å¤§tokens",
            "timeout": "è¶…æ—¶",
        }

    def generate(self, product_name, product_features="", video_type="å•†å“ä»‹ç»", duration="15ç§’", language="ç®€ä½“ä¸­æ–‡",
                 reference_image_url="", reference_image_description="", system_prompt=DEFAULT_SYSTEM_PROMPT, user_prompt_template=DEFAULT_USER_PROMPT,
                 api_base="https://api.kuai.host", api_key="", model="deepseek-v3.2-exp", 
                 temperature=0.7, max_tokens=2000, timeout=150):
        
        if not product_name or not str(product_name).strip():
            raise RuntimeError("äº§å“åç§°ä¸ºå¿…å¡«é¡¹")
        
        api_key = env_or(api_key, "KUAI_API_KEY")
        endpoint = api_base.rstrip("/") + "/v1/chat/completions"

        product_name = str(product_name).strip()
        product_features = str(product_features or '').strip() or 'å±•ç¤ºäº§å“çš„ç‹¬ç‰¹ç‰¹ç‚¹å’Œä¼˜åŠ¿'
        lang = language
        
        # ä½¿ç”¨ string.Template æ›¿æ¢å˜é‡
        from string import Template
        try:
            final_system = Template(system_prompt).safe_substitute(
                language=lang,
                duration=duration,
                video_type=video_type
            )
        except Exception as e:
            print(f"[SoraPromptFromProduct] ç³»ç»Ÿæç¤ºè¯æ›¿æ¢é”™è¯¯: {e}")
            final_system = system_prompt
        
        reference_image_info = f'å‚è€ƒå›¾ç‰‡URL: {reference_image_url}' if reference_image_url else ''
        reference_image_desc = f'å‚è€ƒå›¾æè¿°: {reference_image_description}' if reference_image_description else ''
        try:
            final_user = Template(user_prompt_template).safe_substitute(
                product_name=product_name,
                product_features=product_features,
                video_type=video_type,
                language=lang,
                duration=duration,
                reference_image_info=reference_image_info,
                reference_image_description=reference_image_desc
            )
        except Exception as e:
            print(f"[SoraPromptFromProduct] ç”¨æˆ·æç¤ºè¯æ›¿æ¢é”™è¯¯: {e}")
            final_user = user_prompt_template
        
        print(f"[SoraPromptFromProduct] äº§å“åç§°: {product_name}")
        print(f"[SoraPromptFromProduct] äº§å“å–ç‚¹: {product_features[:50]}...")
        print(f"[SoraPromptFromProduct] æœ€ç»ˆç”¨æˆ·æç¤ºè¯é¢„è§ˆ: {final_user[:200]}...")

        payload = {
            "model": model,
            "stream": False,
            "messages": [
                {"role": "system", "content": final_system},
                {"role": "user", "content": final_user}
            ],
            "temperature": float(temperature),
            "max_tokens": int(max_tokens),
        }

        try:
            resp = requests.post(endpoint, headers=http_headers_json(api_key), data=json.dumps(payload), timeout=int(timeout))
            if resp.status_code >= 400:
                detail = extract_error_message_from_response(resp)
                raise RuntimeError(f"AI æç¤ºè¯ç”Ÿæˆå¤±è´¥: {detail}")
            data = resp.json()
        except RuntimeError:
            raise
        except Exception as e:
            raise RuntimeError(f"AI è°ƒç”¨å¤±è´¥: {str(e)}")

        sora_prompt = ""
        try:
            choices = data.get("choices", [])
            if choices:
                sora_prompt = (choices[0].get("message") or {}).get("content", "").strip()
        except Exception:
            pass

        if not sora_prompt:
            raise RuntimeError(f"AI å“åº”ç¼ºå°‘æç¤ºè¯: {json.dumps(data, ensure_ascii=False)[:500]}")

        print(f"[SoraPromptFromProduct] ç”Ÿæˆçš„æç¤ºè¯é•¿åº¦: {len(sora_prompt)}")

        duration_seconds = duration.replace("ç§’", "")
        return (sora_prompt, duration_seconds, reference_image_url, json.dumps(data, ensure_ascii=False))

    def build(self, ocr_text, style="", camera="", motion="", lighting="", mood="", language="zh", extra=""):
        ocr_clean = ' '.join(ocr_text.split()).strip()
        if (language or "").lower().startswith("zh"):
            prompt = (
                f"æ ¹æ®å‚è€ƒå›¾åƒè¿›è¡Œé£æ ¼ä¸æ„å›¾ä¸€è‡´çš„åŠ¨ç”»ç”Ÿæˆï¼›ä¸»ä½“ä¸åœºæ™¯æºäºå‚è€ƒå›¾çš„è¯­ä¹‰è¦ç‚¹ã€‚\n"
                f"ä¸»ä½“ä¸åœºæ™¯è¦ç‚¹ï¼ˆOCR/è§£æï¼‰ï¼š{ocr_clean}\né£æ ¼ï¼š{style}\né•œå¤´ï¼š{camera}\n"
                f"è¿åŠ¨ï¼š{motion}\nå…‰æ•ˆï¼š{lighting}\næƒ…ç»ªï¼š{mood}\n"
                f"{('é¢å¤–æç¤ºï¼š' + extra.strip()) if extra.strip() else ''}\n"
                f"è¦æ±‚ï¼šç”»é¢ç¨³å®šã€è‡ªç„¶è¿‡æ¸¡ã€ç»†èŠ‚ä¸°å¯Œï¼Œé¿å…è¿‡åº¦å˜å½¢æˆ–é—ªçƒï¼›ä¿æŒä¸å‚è€ƒå›¾è§†è§‰ç»Ÿä¸€ã€‚"
            )
        else:
            prompt = (
                f"Animate in the same style and composition as the reference image.\n"
                f"Key elements: {ocr_clean}\nStyle: {style}\nCamera: {camera}\n"
                f"Motion: {motion}\nLighting: {lighting}\nMood: {mood}\n"
                f"{('Extra: ' + extra.strip()) if extra.strip() else ''}\n"
                f"Requirements: stable frames, natural transitions, rich details, avoid artifacts."
            )
        return (prompt,)

NODE_CLASS_MAPPINGS = {
    "ProductInfoBuilder": ProductInfoBuilder,
    "SoraPromptFromProduct": SoraPromptFromProduct,
}

NODE_DISPLAY_NAME_MAPPINGS = {
    "ProductInfoBuilder": "ğŸ“¦ äº§å“ä¿¡æ¯æ„å»ºå™¨",
    "SoraPromptFromProduct": "ğŸ¤– AIç”Ÿæˆæç¤ºè¯",
}
