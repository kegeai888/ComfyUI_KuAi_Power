# Nano Banana å¤šè½®å¯¹è¯ä½¿ç”¨æŒ‡å—

## ä»€ä¹ˆæ˜¯å¤šè½®å¯¹è¯ï¼Ÿ

å¤šè½®å¯¹è¯å…è®¸ä½ é€šè¿‡è¿ç»­çš„å¯¹è¯æ¥è¿­ä»£å¼åœ°ä¿®æ”¹å’Œå®Œå–„å›¾åƒï¼Œæ¯ä¸€è½®éƒ½åŸºäºä¸Šä¸€è½®ç”Ÿæˆçš„å›¾åƒè¿›è¡Œè°ƒæ•´ã€‚

---

## å·¥ä½œåŸç†

### çŠ¶æ€ä¿æŒæœºåˆ¶

åœ¨ ComfyUI ä¸­ï¼Œ`NanoBananaMultiTurnChat` èŠ‚ç‚¹é€šè¿‡**å®ä¾‹çŠ¶æ€**æ¥ä¿æŒå¯¹è¯å†å²ï¼š

```python
class NanoBananaMultiTurnChat:
    def __init__(self):
        self.conversation_history = []    # ä¿å­˜æ‰€æœ‰å¯¹è¯
        self.last_image_base64 = None     # ä¿å­˜ä¸Šä¸€è½®çš„å›¾åƒ
```

### æ‰§è¡Œæµç¨‹

```
ç¬¬ä¸€è½®:
  ç”¨æˆ·è¾“å…¥ â†’ ç”Ÿæˆå›¾åƒ â†’ ä¿å­˜å›¾åƒå’Œå¯¹è¯
                â†“
ç¬¬äºŒè½®:
  ç”¨æˆ·è¾“å…¥ + ä¸Šä¸€è½®å›¾åƒ â†’ ç”Ÿæˆæ–°å›¾åƒ â†’ æ›´æ–°ä¿å­˜
                â†“
ç¬¬ä¸‰è½®:
  ç”¨æˆ·è¾“å…¥ + ä¸Šä¸€è½®å›¾åƒ â†’ ç”Ÿæˆæ–°å›¾åƒ â†’ æ›´æ–°ä¿å­˜
                â†“
  ...ç»§ç»­...
```

---

## ä½¿ç”¨æ­¥éª¤

### 1. æ·»åŠ èŠ‚ç‚¹

åœ¨ ComfyUI ä¸­æ·»åŠ  `NanoBananaMultiTurnChat` èŠ‚ç‚¹ï¼š
- æ–¹æ³• 1: å³é”®èœå• â†’ `KuAi/NanoBanana` â†’ `ğŸŒ Nano Banana å¤šè½®å¯¹è¯`
- æ–¹æ³• 2: å¿«æ·é”® `Ctrl+Shift+K` â†’ é€‰æ‹© `ğŸŒ Nano Banana å›¾åƒç”Ÿæˆ` â†’ ç‚¹å‡» `ğŸŒ Nano Banana å¤šè½®å¯¹è¯`

### 2. é…ç½®å‚æ•°

**å¿…éœ€å‚æ•°**:
- `model_name`: é€‰æ‹©æ¨¡å‹ï¼ˆé»˜è®¤ `gemini-3-pro-image-preview`ï¼‰
- `prompt`: è¾“å…¥æç¤ºè¯
- `reset_chat`: æ˜¯å¦é‡ç½®å¯¹è¯ï¼ˆé»˜è®¤ `False`ï¼‰
- `aspect_ratio`: å›¾åƒå®½é«˜æ¯”ï¼ˆé»˜è®¤ `1:1`ï¼‰
- `image_size`: å›¾åƒå°ºå¯¸ï¼ˆé»˜è®¤ `2K`ï¼‰
- `temperature`: ç”Ÿæˆæ¸©åº¦ï¼ˆé»˜è®¤ `1.0`ï¼‰

**å¯é€‰å‚æ•°**:
- `image_input`: åˆå§‹å‚è€ƒå›¾åƒï¼ˆä»…é¦–æ¬¡å¯¹è¯ä½¿ç”¨ï¼‰
- `api_base`: API ç«¯ç‚¹ï¼ˆé»˜è®¤ `https://api.kuai.host`ï¼‰
- `api_key`: API å¯†é’¥ï¼ˆæˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡ `KUAI_API_KEY`ï¼‰
- `timeout`: è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ 120 ç§’ï¼‰

### 3. ç¬¬ä¸€è½®å¯¹è¯

**ç¤ºä¾‹**:
```
prompt: "Create an image of a clear perfume bottle sitting on a vanity."
reset_chat: False
```

**æ‰§è¡Œå**:
- ç”Ÿæˆåˆå§‹å›¾åƒ
- å›¾åƒä¿å­˜åœ¨èŠ‚ç‚¹å†…éƒ¨çŠ¶æ€ä¸­
- å¯¹è¯å†å²å¼€å§‹è®°å½•

### 4. ç¬¬äºŒè½®å¯¹è¯

**é‡è¦**: ä½¿ç”¨**åŒä¸€ä¸ªèŠ‚ç‚¹å®ä¾‹**

**ç¤ºä¾‹**:
```
prompt: "Change the color of the liquid inside the glass bottle to a vibrant royal blue"
reset_chat: False
```

**æ‰§è¡Œå**:
- èŠ‚ç‚¹è‡ªåŠ¨ä½¿ç”¨ä¸Šä¸€è½®çš„å›¾åƒä½œä¸ºå‚è€ƒ
- ç”Ÿæˆä¿®æ”¹åçš„å›¾åƒ
- æ›´æ–°å¯¹è¯å†å²

### 5. ç¬¬ä¸‰è½®å¯¹è¯

**ç¤ºä¾‹**:
```
prompt: "Extreme close-up on the glass texture and silver cap of the blue perfume bottle"
reset_chat: False
```

**æ‰§è¡Œå**:
- ç»§ç»­åŸºäºä¸Šä¸€è½®å›¾åƒè¿›è¡Œä¿®æ”¹
- ç”Ÿæˆæ›´ç²¾ç»†çš„å›¾åƒ

### 6. é‡ç½®å¯¹è¯

å½“ä½ æƒ³å¼€å§‹æ–°çš„å¯¹è¯æ—¶ï¼š
```
reset_chat: True
```

è¿™ä¼šæ¸…ç©ºå¯¹è¯å†å²å’Œä¿å­˜çš„å›¾åƒã€‚

---

## å®Œæ•´å·¥ä½œæµç¤ºä¾‹

### ç¤ºä¾‹ 1: äº§å“è®¾è®¡è¿­ä»£

```
å·¥ä½œæµ:
NanoBananaMultiTurnChat
  â†“
ç¬¬ä¸€è½®: "Create a modern smartphone design"
  â†’ ç”Ÿæˆåˆå§‹è®¾è®¡
  â†“
ç¬¬äºŒè½®: "Make the screen larger and add curved edges"
  â†’ åŸºäºç¬¬ä¸€è½®ä¿®æ”¹
  â†“
ç¬¬ä¸‰è½®: "Change the color to midnight blue"
  â†’ ç»§ç»­è°ƒæ•´
  â†“
PreviewImage (æŸ¥çœ‹æœ€ç»ˆç»“æœ)
```

### ç¤ºä¾‹ 2: è‰ºæœ¯åˆ›ä½œ

```
å·¥ä½œæµ:
LoadImage (å¯é€‰ï¼šæä¾›åˆå§‹å›¾åƒ)
  â†“
NanoBananaMultiTurnChat
  â†“
ç¬¬ä¸€è½®: "Transform this into an oil painting style"
  â†’ é£æ ¼è½¬æ¢
  â†“
ç¬¬äºŒè½®: "Add more vibrant colors and dramatic lighting"
  â†’ å¢å¼ºæ•ˆæœ
  â†“
ç¬¬ä¸‰è½®: "Focus on the central subject, blur the background"
  â†’ ç²¾ç»†è°ƒæ•´
  â†“
SaveImage
```

### ç¤ºä¾‹ 3: åœºæ™¯æ„å»º

```
å·¥ä½œæµ:
NanoBananaMultiTurnChat
  â†“
ç¬¬ä¸€è½®: "Create a cozy coffee shop interior"
  â†’ ç”ŸæˆåŸºç¡€åœºæ™¯
  â†“
ç¬¬äºŒè½®: "Add more plants and natural lighting from large windows"
  â†’ æ·»åŠ å…ƒç´ 
  â†“
ç¬¬ä¸‰è½®: "Place a barista behind the counter making coffee"
  â†’ æ·»åŠ äººç‰©
  â†“
ç¬¬å››è½®: "Add warm afternoon sunlight streaming through the windows"
  â†’ è°ƒæ•´æ°›å›´
```

---

## è¾“å‡ºè¯´æ˜

èŠ‚ç‚¹æœ‰ 4 ä¸ªè¾“å‡ºï¼š

1. **å›¾åƒ** (IMAGE)
   - å½“å‰è½®ç”Ÿæˆçš„å›¾åƒ
   - å¯ä»¥è¿æ¥åˆ° `PreviewImage` æˆ– `SaveImage`

2. **å“åº”æ–‡æœ¬** (STRING)
   - AI å¯¹å½“å‰æç¤ºçš„æ–‡æœ¬å“åº”
   - å¯èƒ½åŒ…å«å¯¹ä¿®æ”¹çš„è¯´æ˜

3. **å…ƒæ•°æ®** (STRING)
   - ç”Ÿæˆå…ƒæ•°æ®ï¼ˆfinish_reason, safety_ratings ç­‰ï¼‰
   - ç”¨äºè°ƒè¯•å’Œè´¨é‡æ£€æŸ¥

4. **å¯¹è¯å†å²** (STRING)
   - å®Œæ•´çš„å¯¹è¯å†å²è®°å½•ï¼ˆJSON æ ¼å¼ï¼‰
   - ä¸åŒ…å« base64 å›¾åƒæ•°æ®ï¼ˆå¤ªé•¿ï¼‰
   - æ ¼å¼ç¤ºä¾‹ï¼š
     ```json
     [
       {
         "role": "user",
         "content": "Create a perfume bottle",
         "has_image": false
       },
       {
         "role": "assistant",
         "content": "Image generated",
         "has_image": true
       },
       {
         "role": "user",
         "content": "Make it elegant",
         "has_image": true
       }
     ]
     ```

---

## é‡è¦æ³¨æ„äº‹é¡¹

### âœ… æ­£ç¡®åšæ³•

1. **ä½¿ç”¨åŒä¸€ä¸ªèŠ‚ç‚¹å®ä¾‹**
   - ä¸è¦åˆ é™¤èŠ‚ç‚¹
   - ä¸è¦å¤åˆ¶èŠ‚ç‚¹
   - æ¯æ¬¡æ‰§è¡Œéƒ½ä½¿ç”¨åŒä¸€ä¸ªèŠ‚ç‚¹

2. **æŒ‰é¡ºåºæ‰§è¡Œ**
   - ç­‰å¾…ä¸Šä¸€è½®å®Œæˆåå†æ‰§è¡Œä¸‹ä¸€è½®
   - ä¸è¦è·³è¿‡ä¸­é—´æ­¥éª¤

3. **æ¸…æ™°çš„æç¤ºè¯**
   - æ˜ç¡®è¯´æ˜è¦ä¿®æ”¹ä»€ä¹ˆ
   - ä½¿ç”¨ç›¸å¯¹æè¿°ï¼ˆ"æ›´å¤§"ã€"æ›´äº®"ã€"æ·»åŠ ..."ï¼‰

### âŒ å¸¸è§é”™è¯¯

1. **åˆ é™¤èŠ‚ç‚¹åé‡æ–°æ·»åŠ **
   - âŒ é”™è¯¯ï¼šçŠ¶æ€ä¼šä¸¢å¤±
   - âœ… æ­£ç¡®ï¼šå§‹ç»ˆä½¿ç”¨åŒä¸€ä¸ªèŠ‚ç‚¹

2. **å¤åˆ¶èŠ‚ç‚¹**
   - âŒ é”™è¯¯ï¼šæ–°èŠ‚ç‚¹æ²¡æœ‰å¯¹è¯å†å²
   - âœ… æ­£ç¡®ï¼šä½¿ç”¨åŸèŠ‚ç‚¹æˆ–è®¾ç½® `reset_chat=True`

3. **é‡æ–°åŠ è½½å·¥ä½œæµ**
   - âŒ é”™è¯¯ï¼šçŠ¶æ€ä¼šä¸¢å¤±
   - âœ… æ­£ç¡®ï¼šåœ¨åŒä¸€ä¼šè¯ä¸­å®Œæˆæ‰€æœ‰å¯¹è¯

4. **å¿˜è®°è®¾ç½® API Key**
   - âŒ é”™è¯¯ï¼šèŠ‚ç‚¹ä¼šæŠ¥é”™
   - âœ… æ­£ç¡®ï¼šè®¾ç½®ç¯å¢ƒå˜é‡æˆ–åœ¨èŠ‚ç‚¹ä¸­å¡«å†™

---

## é«˜çº§æŠ€å·§

### 1. ä½¿ç”¨åˆå§‹å›¾åƒ

åœ¨ç¬¬ä¸€è½®å¯¹è¯æ—¶æä¾› `image_input`ï¼š
```
LoadImage â†’ NanoBananaMultiTurnChat (image_input)
prompt: "Transform this image into a watercolor painting"
```

### 2. ç»„åˆä½¿ç”¨

```
NanoBananaAIO (ç”Ÿæˆå¤šä¸ªå€™é€‰)
  â†“ é€‰æ‹©æœ€å¥½çš„ä¸€ä¸ª
LoadImage
  â†“
NanoBananaMultiTurnChat (ç²¾ç»†è°ƒæ•´)
  â†“ å¤šè½®è¿­ä»£
SaveImage
```

### 3. åˆ†æ”¯å¯¹è¯

å¦‚æœæƒ³å°è¯•ä¸åŒçš„ä¿®æ”¹æ–¹å‘ï¼š
1. åœ¨æŸä¸€è½®åå¤åˆ¶èŠ‚ç‚¹
2. åœ¨æ–°èŠ‚ç‚¹ä¸Šè®¾ç½® `reset_chat=False`
3. å°è¯•ä¸åŒçš„æç¤ºè¯

**æ³¨æ„**: å¤åˆ¶çš„èŠ‚ç‚¹ä¸ä¼šç»§æ‰¿çŠ¶æ€ï¼Œéœ€è¦æ‰‹åŠ¨æä¾›å›¾åƒã€‚

### 4. ä¿å­˜ä¸­é—´ç»“æœ

åœ¨æ¯ä¸€è½®åè¿æ¥ `SaveImage` èŠ‚ç‚¹ï¼š
```
NanoBananaMultiTurnChat
  â†“
PreviewImage (æŸ¥çœ‹)
  â†“
SaveImage (ä¿å­˜)
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: "å¯¹è¯å†å²ä¸¢å¤±"

**ç—‡çŠ¶**: èŠ‚ç‚¹ä¼¼ä¹å¿˜è®°äº†ä¹‹å‰çš„å¯¹è¯

**åŸå› **:
- åˆ é™¤å¹¶é‡æ–°æ·»åŠ äº†èŠ‚ç‚¹
- é‡æ–°åŠ è½½äº†å·¥ä½œæµ
- ä½¿ç”¨äº†ä¸åŒçš„èŠ‚ç‚¹å®ä¾‹

**è§£å†³**:
- ä½¿ç”¨åŒä¸€ä¸ªèŠ‚ç‚¹å®ä¾‹
- æˆ–è®¾ç½® `reset_chat=True` é‡æ–°å¼€å§‹

### é—®é¢˜ 2: "ç”Ÿæˆçš„å›¾åƒä¸ä¸Šä¸€è½®æ— å…³"

**ç—‡çŠ¶**: æ–°å›¾åƒæ²¡æœ‰åŸºäºä¸Šä¸€è½®çš„å›¾åƒ

**åŸå› **:
- åç«¯ API æ²¡æœ‰æ­£ç¡®å¤„ç†å¯¹è¯å†å²
- å›¾åƒ base64 æ•°æ®ä¸¢å¤±

**è§£å†³**:
- æ£€æŸ¥åç«¯ API å®ç°
- ç¡®è®¤ `last_image_base64` æ­£ç¡®ä¿å­˜

### é—®é¢˜ 3: "API è°ƒç”¨å¤±è´¥"

**ç—‡çŠ¶**: èŠ‚ç‚¹æŠ¥é”™ "æœªé…ç½® API Key"

**åŸå› **:
- æ²¡æœ‰è®¾ç½® `KUAI_API_KEY` ç¯å¢ƒå˜é‡
- æ²¡æœ‰åœ¨èŠ‚ç‚¹ä¸­å¡«å†™ `api_key`

**è§£å†³**:
```bash
# æ–¹æ³• 1: è®¾ç½®ç¯å¢ƒå˜é‡
export KUAI_API_KEY=your_key_here

# æ–¹æ³• 2: åœ¨ .env æ–‡ä»¶ä¸­é…ç½®
echo "KUAI_API_KEY=your_key_here" > .env

# æ–¹æ³• 3: åœ¨èŠ‚ç‚¹å‚æ•°ä¸­å¡«å†™
api_key: "your_key_here"
```

### é—®é¢˜ 4: "ç”Ÿæˆé€Ÿåº¦æ…¢"

**ç—‡çŠ¶**: æ¯è½®å¯¹è¯éœ€è¦å¾ˆé•¿æ—¶é—´

**åŸå› **:
- ç½‘ç»œå»¶è¿Ÿ
- API æœåŠ¡å™¨è´Ÿè½½é«˜
- base64 æ•°æ®é‡å¤§

**è§£å†³**:
- ä½¿ç”¨è¾ƒå°çš„ `image_size`ï¼ˆ1K è€Œä¸æ˜¯ 4Kï¼‰
- é™ä½ `temperature`ï¼ˆæ›´ç¡®å®šæ€§çš„ç”Ÿæˆï¼‰
- æ£€æŸ¥ç½‘ç»œè¿æ¥

---

## æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼ä¿®æ”¹

ä¸è¦ä¸€æ¬¡æ€§è¦æ±‚å¤ªå¤šä¿®æ”¹ï¼š
- âŒ å·®: "Make it blue, add flowers, change the background, and make it brighter"
- âœ… å¥½:
  - ç¬¬ä¸€è½®: "Make it blue"
  - ç¬¬äºŒè½®: "Add flowers"
  - ç¬¬ä¸‰è½®: "Change the background"
  - ç¬¬å››è½®: "Make it brighter"

### 2. æ˜ç¡®çš„æŒ‡ä»¤

ä½¿ç”¨æ¸…æ™°ã€å…·ä½“çš„æè¿°ï¼š
- âŒ å·®: "Make it better"
- âœ… å¥½: "Increase the contrast and add more vibrant colors"

### 3. ä¿æŒä¸€è‡´æ€§

åœ¨åŒä¸€å¯¹è¯ä¸­ä¿æŒé£æ ¼å’Œä¸»é¢˜ä¸€è‡´ï¼š
- âœ… å¥½: é€æ­¥å®Œå–„åŒä¸€ä¸ªåœºæ™¯
- âŒ å·®: é¢‘ç¹åˆ‡æ¢å®Œå…¨ä¸åŒçš„ä¸»é¢˜

### 4. é€‚æ—¶é‡ç½®

å½“éœ€è¦å¼€å§‹å…¨æ–°çš„åˆ›ä½œæ—¶ï¼Œä½¿ç”¨ `reset_chat=True`ï¼š
```
å®Œæˆä¸€ä¸ªé¡¹ç›® â†’ reset_chat=True â†’ å¼€å§‹æ–°é¡¹ç›®
```

---

## ç¤ºä¾‹å¯¹è¯è„šæœ¬

### äº§å“æ‘„å½±ä¼˜åŒ–

```
ç¬¬ 1 è½®:
prompt: "Create a professional product photo of a luxury watch on a marble surface"
â†’ ç”ŸæˆåŸºç¡€äº§å“ç…§

ç¬¬ 2 è½®:
prompt: "Add dramatic side lighting to highlight the watch's metallic finish"
â†’ å¢å¼ºå…‰ç…§æ•ˆæœ

ç¬¬ 3 è½®:
prompt: "Blur the background slightly to make the watch stand out more"
â†’ è°ƒæ•´æ™¯æ·±

ç¬¬ 4 è½®:
prompt: "Add subtle reflections on the marble surface"
â†’ æ·»åŠ ç»†èŠ‚
```

### è§’è‰²è®¾è®¡

```
ç¬¬ 1 è½®:
prompt: "Create a fantasy character design - a young wizard with a staff"
â†’ ç”ŸæˆåŸºç¡€è§’è‰²

ç¬¬ 2 è½®:
prompt: "Add more intricate details to the wizard's robes with mystical symbols"
â†’ ä¸°å¯Œæœè£…ç»†èŠ‚

ç¬¬ 3 è½®:
prompt: "Make the staff glow with magical energy"
â†’ æ·»åŠ é­”æ³•æ•ˆæœ

ç¬¬ 4 è½®:
prompt: "Add a mystical aura around the character"
â†’ å¢å¼ºæ°›å›´
```

---

## æ€»ç»“

å¤šè½®å¯¹è¯æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è¿­ä»£å¼åˆ›ä½œå·¥å…·ï¼Œå…³é”®è¦ç‚¹ï¼š

1. âœ… **ä½¿ç”¨åŒä¸€ä¸ªèŠ‚ç‚¹å®ä¾‹**
2. âœ… **æ¸è¿›å¼ä¿®æ”¹**
3. âœ… **æ¸…æ™°çš„æç¤ºè¯**
4. âœ… **ä¿å­˜ä¸­é—´ç»“æœ**
5. âœ… **é€‚æ—¶é‡ç½®å¯¹è¯**

é€šè¿‡å¤šè½®å¯¹è¯ï¼Œä½ å¯ä»¥åƒä¸è®¾è®¡å¸ˆäº¤æµä¸€æ ·ï¼Œé€æ­¥å®Œå–„ä½ çš„åˆ›æ„ï¼Œç›´åˆ°è¾¾åˆ°ç†æƒ³æ•ˆæœï¼

---

**ç›¸å…³æ–‡æ¡£**:
- `CLAUDE.md` - å®Œæ•´æŠ€æœ¯æ–‡æ¡£
- `API_SPECIFICATION.md` - API è§„èŒƒ
- `README.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
